<template>
    <div class="relative flex flex-col gap-4 items-center">
        <!-- bg video -->
        <div class=" absolute top-0 left-0 w-full">
            <div class="absolute top-0 left-0 w-full h-[500px] bg-gray-900 bg-opacity-70"></div>
            <div class="absolute bottom-0 left-0 w-full h-[70px] bg-gray-900 wave-clip"></div>
            <video id="bgVideo" autoplay muted loop class="w-full h-[500px] object-cover">
                <source src="/intro-bgvideo.mov" type="video/mp4">
            </video>
        </div>
        <!-- hero -->
        <div class="flex flex-col gap-8 items-start w-full p-8 text-gray-200 relative z-10">
            <div class="flex w-full gap-4">
                <div class="relative self-start">
                    <img src="/laurel.svg" alt="logo" class="laurel-white w-40" />
                    <span
                        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-300 text-xs text-center">No.1
                        ê³ í’ˆê²©<br>ì‚¬ì§„ ì»¤ë®¤ë‹ˆí‹°</span>
                </div>
                <img src="/icon-512-maskable.png" alt="logo" class="w-12 rounded hover:cursor-pointer" />
            </div>
            <div class="gap-4 flex flex-col *:underline-offset-4 [&_span]:decoration-main [&_span]:font-semibold">
                <h1 class="text-4xl font-semibold">ê°“ ì°ì€ ì‚¬ì§„ì„ ê³µìœ í•˜ê³ , ê²€ìƒ‰í•˜ê³ , ì†Œí†µí•˜ì„¸ìš”.</h1>
                <h2 class="text-lg text-gray-300">ì°½ì¡°ì ì¸ 1% ë‹¹ì‹ ì„ ìœ„í•œ ìµœê³ ì˜ ì‚¬ì§„ ì»¤ë®¤ë‹ˆí‹°</h2>
                <div class="flex flex-col gap-2">
                    <h3>ğŸŒ <span class="underline">ì‚¬ì§„ì„ ì†ì‰½ê²Œ ì—…ë¡œë“œ</span> í•˜ì„¸ìš”</h3>
                    <h3>ğŸ“¸ ë‹¤ë¥¸ ì‘ê°€ë‹˜ì˜ ì‚¬ì§„ì„ <span class="underline">ê³ í•´ìƒë„ë¡œ ì—´ëŒí•˜ì„¸ìš”</span></h3>
                    <h3>ğŸ‘‹ ë‹¤ë¥¸ <span class="underline">ì•„ë§ˆì¶”ì–´ & í”„ë¡œí˜ì…”ë„ ì‘ê°€ë‹˜ê³¼ ì†Œí†µ</span>í•˜ì„¸ìš”</h3>
                    <h3>ğŸ” <span class="underline">ìµœì‹  AI ì´ë¯¸ì§€ ê²€ìƒ‰ ê¸°ìˆ </span>ì„ ì´ìš©í•´ ì›í•˜ëŠ” ì‚¬ì§„ì„ ê²€ìƒ‰í•˜ì„¸ìš”</h3>
                    <h3>ğŸš€ <span class="underline">ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°</span>ì˜ ì¼ì›ì´ ë˜ì„¸ìš”</h3>
                </div>
            </div>
            <div class="flex flex-wrap gap-4 justify-center items-center w-full">
                <span class="text-xs text-gray-400">Powered by</span>
                <img src="/intro-poweredby-azure.png" alt="logo" class="h-10 poweredby-gray" />
                <img src="/intro-poweredby-dotnet.png" alt="logo" class="h-10 poweredby-gray" />
                <img src="/intro-poweredby-pg.png" alt="logo" class="h-10 poweredby-gray-invert" />
                <img src="/intro-poweredby-vue.svg" alt="logo" class="h-10 poweredby-gray-invert" />
            </div>
        </div>
        <!-- hot photo masonry -->
        <div class="relative w-full">
            <div class="absolute top-0 left-0 w-full h-[200px] sm:h-[500px] top-photos-uppershade z-50"></div>
            <div class="px-4 w-full">
                <div id="photoMasonryGrid" class="w-full"></div>
            </div>

        </div>
        <!-- sign up form -->
        <div class="px-4 w-full border-y-0.5 border-gray-700 py-4">
            <h1 class="my-4 text-center text-main text-xl font-semibold">ğŸ‰ íšŒì›ê°€ì… ğŸ™‹â€â™€ï¸</h1>
            <div class="flex flex-col gap-2 text-sm w-full sm:w-1/2 mx-auto">
                <label for="email" class="text-slate-500 ">ì´ë©”ì¼</label>
                <input v-model="signUpForm.email" name="email" type="text" placeholder="ì´ë©”ì¼"
                    class="py-2 px-4 rounded bg-gray-950 border-0.5 border-gray-700 font-normal">
                <label for="password" class="text-slate-500 ">ë¹„ë°€ë²ˆí˜¸</label>
                <input v-model="signUpForm.password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"
                    class="py-2 px-4 rounded bg-gray-950 border-0.5 border-gray-700 font-normal">
                <input v-model="signUpForm.passwordConfirm" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                    class="py-2 px-4 rounded bg-gray-950 border-0.5 border-gray-700 font-normal">
                <span class="text-xs text-slate-500">* 6ì ì´ìƒ, ì˜ë¬¸, ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.</span>
                <DefaultButton @click="onSignUp" class="self-end" type="submit" content="ê°€ì…í•˜ê¸°" />
            </div>
        </div>
    </div>
</template>
<script setup>
import axios from 'axios';
import * as EmailValidator from 'email-validator';
import DefaultButton from '@/components/DefaultButton.vue';
import { ref } from 'vue'
import { onMounted } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter()

const signUpForm = ref({
    email: "",
    password: "",
    passwordConfirm: ""
})
const topPhotos = ref([])

var msnry = null;
const passwordRegex = /^[A-Za-z\d!@#$%^&*()]{6,}$/

const fetchTopPhotos = async () => {
    const result = await axios.get(`${import.meta.env.VITE_API_URL}/api/photos?breakpoints=Small&photoSorts=Top&isDescending=true&includePreUploaded=false&pageIndex=0&pageLimit=15`);
    topPhotos.value = result.data
}

const appendItems = async (photos) => {
    var grid = document.querySelector('#photoMasonryGrid');
    for (const photo of photos) {
        let gridItem = document.createElement('img');
        gridItem.setAttribute('src', photo.largeUrl ?? photo.mediumUrl ?? photo.smallUrl ?? photo.thumbnailUrl ?? photo.url);
        gridItem.setAttribute('class', 'grid-item p-1 object-cover cursor-pointer');
        gridItem.setAttribute('style', `width: ${100 / 3}%; border-radius: 0.5rem;`)
        gridItem.addEventListener('click', () => {
            router.push(`/photos/${photo.id}`)
        });
        grid.appendChild(gridItem);
        msnry.appended(gridItem);
        await new Promise(resolve => setTimeout(resolve, 200));
        msnry.layout();
    };
}

const onSignUp = async () => {
    console.log(signUpForm.value)
    if (signUpForm.value.email === "" || signUpForm.value.password === "" || signUpForm.value.passwordConfirm === "") {
        alert("âŒ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        return
    }
    if (!EmailValidator.validate(signUpForm.value.email)) {
        alert("âŒ ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        return
    }
    if (signUpForm.value.password !== signUpForm.value.passwordConfirm) {
        alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        return
    }
    if (!passwordRegex.test(signUpForm.value.password)) {
        alert("âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒ, ì˜ë¬¸, ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.")
        return
    }
    try {
        await axios.post(`${import.meta.env.VITE_API_URL}/api/auth/signUp`, signUpForm.value)
        alert("âœ… íšŒì›ê°€ì…ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.")
    } catch (e) {
        alert("âŒ íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì•„ì´ë”” ë˜ëŠ” ì´ë©”ì¼ì´ ë‹¤ë¥¸ ê³„ì •ê³¼ ì¤‘ë³µë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
    }
}

onMounted(async () => {

    msnry = new Masonry('#photoMasonryGrid', {
        itemSelector: '.grid-item',
        percentPosition: true,
        columnWidth: document.querySelector('#photoMasonryGrid').clientWidth / 3,
        transitionDuration: '0.2s',
        stagger: 30
    });

    await fetchTopPhotos()
    appendItems(topPhotos.value)
})
</script>
<style scoped>
.laurel-white {
    -webkit-filter: grayscale(1) invert(1);
    filter: grayscale(1) invert(1);
}

.poweredby-gray {
    filter: grayscale(1);
}

.poweredby-gray-invert {
    filter: grayscale(1) invert(1);
}

.top-photos-uppershade {
    background: rgb(17, 24, 39);
    background: linear-gradient(180deg, rgba(17, 24, 39, 1) 11%, rgba(255, 255, 255, 0) 100%);
}

.wave-clip {
    clip-path: polygon(100% 100%, 0% 100% , 0.00% 83.71%, 3.33% 76.12%, 6.67% 67.19%, 10.00% 57.81%, 13.33% 48.88%, 16.67% 41.29%, 20.00% 35.77%, 23.33% 32.87%, 26.67% 32.87%, 30.00% 35.77%, 33.33% 41.29%, 36.67% 48.88%, 40.00% 57.81%, 43.33% 67.19%, 46.67% 76.12%, 50.00% 83.71%, 53.33% 89.23%, 56.67% 92.13%, 60.00% 92.13%, 63.33% 89.23%, 66.67% 83.71%, 70.00% 76.12%, 73.33% 67.19%, 76.67% 57.81%, 80.00% 48.88%, 83.33% 41.29%, 86.67% 35.77%, 90.00% 32.87%, 93.33% 32.87%, 96.67% 35.77%, 100.00% 41.29%);}
</style>